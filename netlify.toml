[build]
  publish = "public"
  command = "npm run build"
  edge_functions = "netlify/edge-functions"

[functions]
  directory = "netlify/edge-functions"

[[edge_functions]]
  function = "auth"
  path     = "/api/*"

  # ===========================
# üîí SECURITY HEADERS
# ===========================
[[headers]]
  for = "/*"
  [headers.values]
    # Content Security Policy - Allow Supabase WebSockets and APIs
    Content-Security-Policy = "default-src 'self'; connect-src 'self' https://*.supabase.co wss://*.supabase.co https://*.workers.dev https://api.stripe.com https://images.weserv.nl; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://unpkg.com https://js.stripe.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https: blob:; font-src 'self' https://fonts.gstatic.com; frame-src https://js.stripe.com; object-src 'none'; base-uri 'self';"
    
    # Additional Security Headers
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "camera=(), microphone=(), geolocation=()"
    
    # HTTPS and HSTS
    Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"

# ===========================
# üîÅ Pretty URL Redirects
# ===========================

[[redirects]]
  from = "/dashboard"
  to = "/dashboard/index.html"
  status = 200

[[redirects]]
  from = "/admin"
  to = "/admin/index.html"
  status = 200

[[redirects]]
  from = "/analytics"
  to = "/analytics/index.html"
  status = 200

[[redirects]]
  from = "/auth"
  to = "/auth/index.html"
  status = 200

[[redirects]]
  from = "/campaigns"
  to = "/campaigns/index.html"
  status = 200

[[redirects]]
  from = "/"
  to = "/home/index.html"
  status = 200

[[redirects]]
  from = "/integrations"
  to = "/integrations/index.html"
  status = 200

[[redirects]]
  from = "/leads"
  to = "/leads/index.html"
  status = 200

[[redirects]]
  from = "/messages"
  to = "/messages/index.html"
  status = 200

[[redirects]]
  from = "/onboarding"
  to = "/onboarding/index.html"
  status = 200

[[redirects]]
  from = "/settings"
  to = "/settings/index.html"
  status = 200

[[redirects]]
  from = "/subscription"
  to = "/subscription/index.html"
  status = 200

# ===========================
# üîÅ Footer Pages
# ===========================

[[redirects]]
  from = "/footer/about"
  to = "/footer/about/index.html"
  status = 200

[[redirects]]
  from = "/footer/api"
  to = "/footer/api/index.html"
  status = 200

[[redirects]]
  from = "/footer/case-studies"
  to = "/footer/case-studies/index.html"
  status = 200

[[redirects]]
  from = "/footer/guides"
  to = "/footer/guides/index.html"
  status = 200

[[redirects]]
  from = "/footer/help"
  to = "/footer/help/index.html"
  status = 200

[[redirects]]
  from = "/footer/pricing"
  to = "/footer/pricing/index.html"
  status = 200

[[redirects]]
  from = "/footer/security"
  to = "/footer/security/index.html"
  status = 200

[[redirects]]
  from = "/footer/status"
  to = "/footer/status/index.html"
  status = 200

# ===========================
# üîÅ Legal Subpages
# ===========================

[[redirects]]
  from = "/footer/legal/privacy"
  to = "/footer/legal/privacy/index.html"
  status = 200

[[redirects]]
  from = "/footer/legal/terms"
  to = "/footer/legal/terms/index.html"
  status = 200

[[redirects]]
  from = "/footer/legal/refund"
  to = "/footer/legal/refund/index.html"
  status = 200

[[redirects]]
  from = "/footer/legal/disclaimer"
  to = "/footer/legal/disclaimer/index.html"
  status = 200
