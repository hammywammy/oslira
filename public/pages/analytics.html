<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Intelligence - Oslira</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="./assets/oslira-logo.png"> 
    
    <!-- Environment Config -->
    <script src="/env-config.js"></script>
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://js.sentry-cdn.com https://cdn.jsdelivr.net https://unpkg.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: blob:; connect-src 'self' https: wss:; font-src 'self' data:; media-src 'self' blob: data:;">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/css/analytics.css">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="/js/shared-code.js" as="script">
    <link rel="preload" href="/js/analytics.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js" as="script">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Advanced analytics intelligence for AI-powered outreach campaigns and lead generation performance.">
    <meta name="keywords" content="analytics, outreach intelligence, campaign performance, lead conversion, message optimization">
    <meta name="author" content="Oslira">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Analytics Intelligence - Oslira">
    <meta property="og:description" content="Strategic analytics and insights for AI-powered outreach campaigns">
    <meta property="og:type" content="website">
    <meta property="og:image" content="./assets/oslira-logo.png">
    
    <!-- Schema.org Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Oslira Analytics Intelligence",
        "description": "Strategic analytics dashboard for outreach campaign performance",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web Browser"
    }
    </script>
</head>
<body class="dashboard">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <img src="./assets/oslira-logo.png" alt="Oslira" class="loading-logo">
            <div class="loading-spinner"></div>
            <p>Initializing Analytics Intelligence...</p>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="logo">
            <img src="./assets/oslira-logo.png" alt="Oslira Logo" class="logo-image">
            <span>Oslira</span>
        </div>
        
        <nav class="menu" role="navigation" aria-label="Main navigation">
<div class="menu-section">
    <h4>Tools</h4>
    <a href="./messages.html" data-page="messages" aria-label="Message Studio">
        <span class="icon" aria-hidden="true">💬</span>
        <span>Message Studio</span>
    </a>
    <a href="./campaigns.html" data-page="campaigns" aria-label="Campaigns">
        <span class="icon" aria-hidden="true">🚀</span>
        <span>Campaigns</span>
    </a>
    <a href="./integrations.html" data-page="integrations" aria-label="Integrations">
        <span class="icon" aria-hidden="true">🔗</span>
        <span>Integrations</span>
    </a>
</div>
            
            <div class="menu-section">
                <h4>Tools</h4>
                <a href="/messages.html" data-page="messages" aria-label="Message Studio">
                    <span class="icon" aria-hidden="true">💬</span>
                    <span>Message Studio</span>
                </a>
                <a href="/campaigns.html" data-page="campaigns" aria-label="Campaigns">
                    <span class="icon" aria-hidden="true">🚀</span>
                    <span>Campaigns</span>
                </a>
                <a href="/integrations.html" data-page="integrations" aria-label="Integrations">
                    <span class="icon" aria-hidden="true">🔗</span>
                    <span>Integrations</span>
                </a>
            </div>
            
<div class="menu-section">
    <h4>Tools</h4>
    <a href="./messages.html" data-page="messages" aria-label="Message Studio">
        <span class="icon" aria-hidden="true">💬</span>
        <span>Message Studio</span>
    </a>
    <a href="./campaigns.html" data-page="campaigns" aria-label="Campaigns">
        <span class="icon" aria-hidden="true">🚀</span>
        <span>Campaigns</span>
    </a>
    <a href="./integrations.html" data-page="integrations" aria-label="Integrations">
        <span class="icon" aria-hidden="true">🔗</span>
        <span>Integrations</span>
    </a>
</div>
        </nav>
        
        <!-- Subscription Status -->
        <div class="subscription-status">
            <h4>Current Plan</h4>
            <p class="plan-name" id="plan-name">Loading...</p>
            <p class="credits-info">
                <span id="credits-remaining">--</span> credits remaining
            </p>
            <a href="/subscription.html" data-page="subscription">Manage Subscription</a>
        </div>
        
        <!-- User Info -->
        <div class="user-info">
            <p id="user-email">Loading...</p>
            <a href="javascript:void(0)" id="logout-btn" role="button" aria-label="Sign out">Sign Out</a>
        </div>
    </aside>
    
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation menu">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
    </button>
    
    <!-- Main Content -->
    <main class="main-content" role="main">
        <!-- Analytics Header -->
        <div class="analytics-header">
            <div class="header-top">
                <div class="header-text">
                    <h1 class="header-title">Analytics Intelligence</h1>
                    <p class="header-subtitle">Strategic command center for data-driven outreach optimization and performance insights</p>
                </div>
                <div class="header-controls">
                    <select id="timeframe-select" class="timeframe-select" aria-label="Select time period">
                        <option value="7d">Last 7 Days</option>
                        <option value="30d" selected>Last 30 Days</option>
                        <option value="90d">Last 90 Days</option>
                        <option value="1y">Last Year</option>
                    </select>
                    <button class="secondary-btn" id="refresh-analytics" aria-label="Refresh analytics data">
                        <span aria-hidden="true">🔄</span>
                        <span>Refresh</span>
                    </button>
                    <button class="primary-btn" id="export-analytics" aria-label="Export analytics data">
                        <span aria-hidden="true">📥</span>
                        <span>Export</span>
                    </button>
                </div>
            </div>
            
            <!-- Live Update Indicator -->
            <div class="live-indicator">
                <div class="live-dot"></div>
                <span>Live Analytics • Last updated: <span id="last-update">--</span></span>
            </div>
        </div>
        
        <!-- View Navigation -->
        <div class="view-navigation" role="tablist" aria-label="Analytics views">
            <button class="view-tab active" data-view="overview" role="tab" aria-selected="true" aria-controls="analytics-content">
                <span aria-hidden="true">🏠</span>
                <span>Overview</span>
            </button>
            <button class="view-tab" data-view="message-performance" role="tab" aria-selected="false" aria-controls="analytics-content">
                <span aria-hidden="true">🎨</span>
                <span>Message Performance</span>
            </button>
            <button class="view-tab" data-view="lead-conversion" role="tab" aria-selected="false" aria-controls="analytics-content">
                <span aria-hidden="true">🔍</span>
                <span>Lead Conversion</span>
            </button>
            <button class="view-tab" data-view="cta-effectiveness" role="tab" aria-selected="false" aria-controls="analytics-content">
                <span aria-hidden="true">📣</span>
                <span>CTA Analysis</span>
            </button>
            <button class="view-tab" data-view="feedback-explorer" role="tab" aria-selected="false" aria-controls="analytics-content">
                <span aria-hidden="true">🧠</span>
                <span>Feedback Explorer</span>
            </button>
            <button class="view-tab" data-view="claude-guidance" role="tab" aria-selected="false" aria-controls="analytics-content">
                <span aria-hidden="true">🧭</span>
                <span>Claude Guidance</span>
            </button>
            <button class="view-tab" data-view="risk-assessment" role="tab" aria-selected="false" aria-controls="analytics-content">
                <span aria-hidden="true">🚦</span>
                <span>Risk Assessment</span>
            </button>
            <button class="view-tab" data-view="team-impact" role="tab" aria-selected="false" aria-controls="analytics-content">
                <span aria-hidden="true">👥</span>
                <span>Team Impact</span>
            </button>
        </div>
        
        <!-- Analytics Content -->
        <div class="analytics-content" id="analytics-content" role="tabpanel" aria-labelledby="current-view">
            <!-- Loading State -->
            <div class="analytics-loading" id="analytics-loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p>Loading analytics data...</p>
            </div>
            
            <!-- Error State -->
            <div class="analytics-error" id="analytics-error" style="display: none;" role="alert">
                <!-- Error content will be populated by JavaScript -->
            </div>
            
            <!-- Content will be dynamically populated by analytics.js -->
            <div class="analytics-placeholder">
                <div class="placeholder-content">
                    <div class="placeholder-icon">📊</div>
                    <h3>Initializing Analytics Intelligence</h3>
                    <p>Loading strategic insights and performance data...</p>
                </div>
            </div>
        </div>
        
        <!-- Quick Insights Sidebar -->
        <aside class="quick-insights-sidebar" id="quick-insights" role="complementary" aria-label="Quick insights">
            <div class="insights-header">
                <h3>
                    <span aria-hidden="true">⚡</span>
                    Quick Insights
                </h3>
            </div>
            
            <div class="insight-item">
                <div class="insight-metric">
                    <span class="metric-value" id="today-messages">--</span>
                    <span class="metric-label">Messages Today</span>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-metric">
                    <span class="metric-value" id="avg-score-trend">--</span>
                    <span class="metric-label">Score Trend</span>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-metric">
                    <span class="metric-value" id="risk-alerts">--</span>
                    <span class="metric-label">Risk Alerts</span>
                </div>
            </div>
            
            <div class="insight-actions">
                <button class="insight-action-btn" id="claude-suggestion" aria-label="Get Claude suggestion">
                    <span aria-hidden="true">🧠</span>
                    <span>Ask Claude</span>
                </button>
                <button class="insight-action-btn" id="optimize-now" aria-label="Optimize performance">
                    <span aria-hidden="true">⚡</span>
                    <span>Optimize</span>
                </button>
            </div>
        </aside>
    </main>
    
    <!-- Floating Action Button for Quick Actions -->
    <div class="fab-container">
        <button class="fab" id="quick-actions-fab" aria-label="Quick actions menu">
            <span aria-hidden="true">⚡</span>
        </button>
        <div class="fab-menu" id="fab-menu">
            <button class="fab-action" data-action="export" aria-label="Quick export">
                <span aria-hidden="true">📥</span>
            </button>
            <button class="fab-action" data-action="refresh" aria-label="Quick refresh">
                <span aria-hidden="true">🔄</span>
            </button>
            <button class="fab-action" data-action="insights" aria-label="Claude insights">
                <span aria-hidden="true">🧠</span>
            </button>
            <button class="fab-action" data-action="share" aria-label="Share analytics">
                <span aria-hidden="true">📤</span>
            </button>
        </div>
    </div>
    
    <!-- Modal Overlays -->
    
    <!-- Export Modal -->
    <div class="modal-overlay" id="export-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Analytics Data</h3>
                <button class="close-btn" type="button" aria-label="Close export modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <div class="export-format">
                        <h4>Export Format</h4>
                        <label><input type="radio" name="export-format" value="pdf" checked> PDF Report</label>
                        <label><input type="radio" name="export-format" value="excel"> Excel Workbook</label>
                        <label><input type="radio" name="export-format" value="csv"> CSV Data</label>
                        <label><input type="radio" name="export-format" value="json"> JSON Raw Data</label>
                    </div>
                    <div class="export-scope">
                        <h4>Data Scope</h4>
                        <label><input type="checkbox" checked> Performance Metrics</label>
                        <label><input type="checkbox" checked> Message Analysis</label>
                        <label><input type="checkbox" checked> Lead Conversion Data</label>
                        <label><input type="checkbox"> CTA Effectiveness</label>
                        <label><input type="checkbox"> Risk Assessments</label>
                        <label><input type="checkbox"> Claude Insights</label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="secondary-btn" type="button" onclick="this.closest('.modal-overlay').style.display='none'">Cancel</button>
                    <button class="primary-btn" type="button" id="confirm-export">
                        <span aria-hidden="true">📥</span>
                        Export Data
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Claude Insights Modal -->
    <div class="modal-overlay" id="claude-modal" style="display: none;">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h3>🧠 Claude Strategic Insights</h3>
                <button class="close-btn" type="button" aria-label="Close Claude insights modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="claude-conversation">
                    <div class="claude-avatar">
                        <span aria-hidden="true">🧠</span>
                    </div>
                    <div class="claude-response" id="claude-response">
                        <p>Analyzing your current performance data...</p>
                    </div>
                </div>
                <div class="claude-suggestions" id="claude-suggestions">
                    <!-- Suggestions will be populated dynamically -->
                </div>
                <div class="claude-actions">
                    <button class="secondary-btn" type="button" id="regenerate-insights">
                        <span aria-hidden="true">🔄</span>
                        Regenerate
                    </button>
                    <button class="primary-btn" type="button" id="apply-suggestions">
                        <span aria-hidden="true">✅</span>
                        Apply Suggestions
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Risk Alert Modal -->
    <div class="modal-overlay" id="risk-alert-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⚠️ Risk Assessment Alert</h3>
                <button class="close-btn" type="button" aria-label="Close risk alert modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="risk-summary" id="risk-modal-content">
                    <!-- Risk details will be populated dynamically -->
                </div>
                <div class="risk-actions">
                    <button class="secondary-btn" type="button" onclick="this.closest('.modal-overlay').style.display='none'">
                        Dismiss
                    </button>
                    <button class="primary-btn" type="button" id="review-risks">
                        <span aria-hidden="true">🔍</span>
                        Review All Risks
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Keyboard Shortcuts Modal -->
    <div class="modal-overlay" id="shortcuts-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⌨️ Keyboard Shortcuts</h3>
                <button class="close-btn" type="button" aria-label="Close shortcuts modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-section">
                        <h4>Navigation</h4>
                        <div class="shortcut-item">
                            <kbd>1</kbd> - <kbd>8</kbd>
                            <span>Switch view tabs</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>R</kbd>
                            <span>Refresh data</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>E</kbd>
                            <span>Export analytics</span>
                        </div>
                    </div>
                    <div class="shortcut-section">
                        <h4>Actions</h4>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>C</kbd>
                            <span>Ask Claude</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>O</kbd>
                            <span>Optimize performance</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>?</kbd>
                            <span>Show shortcuts</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Help Button -->
    <button class="help-btn" id="help-btn" type="button" aria-label="Show keyboard shortcuts">
        <span aria-hidden="true">?</span>
    </button>
    
    <!-- Notification Container -->
    <div class="notification-container" id="notifications" aria-live="polite" aria-label="Notifications">
        <!-- Notifications will be dynamically added here -->
    </div>
    
    <!-- Scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/shared-code.js"></script>
    <script src="/js/analytics.js"></script>
    
    <!-- Additional Analytics Scripts -->
    <script>
        // Analytics page specific initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize tooltips and help text
            initializeTooltips();
            
            // Initialize keyboard shortcuts
            initializeKeyboardShortcuts();
            
            // Initialize mobile menu
            initializeMobileMenu();
            
            // Initialize FAB menu
            initializeFABMenu();
        });
        
        function initializeTooltips() {
            // Add tooltips to complex metrics
            const tooltipElements = document.querySelectorAll('[data-tooltip]');
            tooltipElements.forEach(element => {
                element.addEventListener('mouseenter', showTooltip);
                element.addEventListener('mouseleave', hideTooltip);
            });
        }
        
        function initializeKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // View switching shortcuts (1-8)
                if (e.key >= '1' && e.key <= '8') {
                    const tabs = document.querySelectorAll('.view-tab');
                    const index = parseInt(e.key) - 1;
                    if (tabs[index]) {
                        tabs[index].click();
                    }
                }
                
                // Action shortcuts
                if (e.key === 'r' || e.key === 'R') {
                    e.preventDefault();
                    document.getElementById('refresh-analytics')?.click();
                }
                
                if (e.key === 'e' || e.key === 'E') {
                    e.preventDefault();
                    document.getElementById('export-analytics')?.click();
                }
                
                if ((e.ctrlKey || e.metaKey) && e.key === 'c') {
                    e.preventDefault();
                    document.getElementById('claude-suggestion')?.click();
                }
                
                if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
                    e.preventDefault();
                    document.getElementById('optimize-now')?.click();
                }
                
                if (e.key === '?') {
                    e.preventDefault();
                    document.getElementById('shortcuts-modal').style.display = 'flex';
                }
            });
        }
        
        function initializeMobileMenu() {
            const toggle = document.getElementById('mobile-menu-toggle');
            const sidebar = document.getElementById('sidebar');
            
            if (toggle && sidebar) {
                toggle.addEventListener('click', function() {
                    sidebar.classList.toggle('open');
                });
            }
        }
        
        function initializeFABMenu() {
            const fab = document.getElementById('quick-actions-fab');
            const menu = document.getElementById('fab-menu');
            
            if (fab && menu) {
                fab.addEventListener('click', function() {
                    menu.classList.toggle('open');
                });
                
                // Handle FAB action clicks
                menu.addEventListener('click', function(e) {
                    const action = e.target.closest('.fab-action')?.dataset.action;
                    if (action) {
                        handleFABAction(action);
                        menu.classList.remove('open');
                    }
                });
            }
        }
        
        function handleFABAction(action) {
            switch (action) {
                case 'export':
                    document.getElementById('export-analytics')?.click();
                    break;
                case 'refresh':
                    document.getElementById('refresh-analytics')?.click();
                    break;
                case 'insights':
                    document.getElementById('claude-suggestion')?.click();
                    break;
                case 'share':
                    // Implement share functionality
                    console.log('Share analytics triggered');
                    break;
            }
        }
        
        function showTooltip(e) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = e.target.dataset.tooltip;
            document.body.appendChild(tooltip);
            
            const rect = e.target.getBoundingClientRect();
            tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
            tooltip.style.top = rect.top - tooltip.offsetHeight - 8 + 'px';
        }
        
        function hideTooltip() {
            const tooltip = document.querySelector('.tooltip');
            if (tooltip) {
                tooltip.remove();
            }
        }
    </script>
    
    <!-- Analytics Tracking (if configured) -->
    <script>
        if (window.CONFIG?.ANALYTICS_ID) {
            // Analytics initialization would go here
            console.log('Analytics tracking configured');
        }
    </script>
</body>
</html>
