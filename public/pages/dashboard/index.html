<!DOCTYPE html>
<html lang="en">
<head>
    <script src="/core/script-loader.js"></script>
    <link rel="icon" type="image/png" href="/assets/images/oslira-logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Oslira</title>
    <link rel="stylesheet" href="/pages/dashboard/dashboard.css">
</head>
<body>
    <a href="#main-content" class="skip-nav">Skip to main content</a>
    
    <div class="dashboard">
        <!-- ============================================================================= -->
        <!-- SIDEBAR -->
        <!-- ============================================================================= -->
        <aside class="sidebar">
            <div class="logo">
                <img src="/assets/images/oslira-logo.png" alt="Oslira Logo" class="logo-image">
                Oslira
            </div>
            
            <!-- Business Selector -->
            <div class="business-selector">
                <h4>Active Business</h4>
                <select id="business-select" aria-label="Select active business">
                    <option value="">Loading businesses...</option>
                </select>
            </div>
            
            <!-- Navigation Menu -->
            <nav class="menu">
                <div class="menu-section">
                    <h4>Main</h4>
                    <a href="/dashboard" class="active">
                        <span class="icon">📊</span>
                        Dashboard
                    </a>
                    <a href="/leads">
                        <span class="icon">🔍</span>
                        Lead Research
                    </a>
                    <a href="/analytics">
                        <span class="icon">📈</span>
                        Analytics
                    </a>
                </div>
                
                <div class="menu-section">
                    <h4>Tools</h4>
                    <a href="/campaigns">
                        <span class="icon">🚀</span>
                        Campaigns
                    </a>
                    <a href="/messages">
                        <span class="icon">💬</span>
                        Messages
                    </a>
                    <a href="/integrations">
                        <span class="icon">🔗</span>
                        Integrations
                    </a>
                </div>
                
                <div class="menu-section">
                    <h4>Account</h4>
                    <a href="/subscription">
                        <span class="icon">💳</span>
                        Subscription
                    </a>
                    <a href="/settings">
                        <span class="icon">⚙️</span>
                        Settings
                    </a>
                </div>
            </nav>
            
            <!-- Subscription Status -->
            <div class="subscription-status">
                <h4>Current Plan</h4>
                <p class="plan-name" id="sidebar-plan">Loading...</p>
                <div class="credits-display" id="sidebar-billing">Loading...</div>
                <a href="/subscription" style="margin-top: 12px; display: inline-block;">Manage Subscription</a>
            </div>
            
            <!-- User Info -->
            <div class="user-info">
                <p id="user-email">Loading...</p>
                <a href="#" id="logout-link">Sign Out</a>
            </div>
        </aside>
        
        <!-- ============================================================================= -->
        <!-- MAIN CONTENT -->
        <!-- ============================================================================= -->
        <main role="main" id="main-content" class="main-content">
            <!-- Header -->
            <header>
                <div>
                    <h1>Welcome back! 👋</h1>
                    <p>Here's what's happening with your lead generation</p>
                </div>
                
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="dashboard.showAnalysisModal()">
                        🔎 Research Lead
                    </button>
                    <button class="btn btn-secondary" onclick="dashboard.showBulkModal()">
                        📁 Bulk Upload
                    </button>
                </div>
            </header>
            
            <!-- Quick Actions -->
            <section class="quick-actions">
                <div class="action-card" onclick="dashboard.showAnalysisModal()">
                    <div class="action-icon">🎯</div>
                    <div>
                        <h3>Research a Lead</h3>
                        <p>Analyze any Instagram profile with AI-powered insights and get personalized outreach messages</p>
                        <span class="action-cost">1-2 CREDITS</span>
                    </div>
                </div>
                
                <div class="action-card" onclick="dashboard.showBulkModal()">
                    <div class="action-icon">🚀</div>
                    <div>
                        <h3>Create Campaign</h3>
                        <p>Build automated outreach sequences with AI-powered message variants and lead targeting</p>
                        <span class="action-badge">NEW</span>
                    </div>
                </div>
                
                <div class="action-card" onclick="window.location.href='/settings'">
                    <div class="action-icon">📊</div>
                    <div>
                        <h3>Import CSV</h3>
                        <p>Upload a CSV file with Instagram profiles for bulk analysis and lead generation</p>
                        <span class="action-badge">BULK</span>
                    </div>
                </div>
                
                <div class="action-card" onclick="window.location.href='/analytics'">
                    <div class="action-icon">📈</div>
                    <div>
                        <h3>Export Data</h3>
                        <p>Download your leads and analysis results in CSV format for external use</p>
                    </div>
                </div>
            </section>
            
            <!-- Stats Grid -->
            <section class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-leads">0</div>
                    <div class="stat-label">Leads Researched</div>
                    <div class="stat-detail">Ready to start</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-value" id="credits-used">0</div>
                    <div class="stat-label">Credits Used</div>
                    <div class="stat-detail">This month</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-value" id="high-value-leads">0</div>
                    <div class="stat-label">High-Value Leads</div>
                    <div class="stat-detail">Score 80+</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-value" id="average-score">0%</div>
                    <div class="stat-label">Average Score</div>
                    <div class="stat-detail">Lead quality</div>
                </div>
            </section>
            
            <!-- Recent Lead Activity -->
            <section class="leads-section">
                <div class="section-header">
                    <h2>Recent Lead Activity</h2>
                    <div class="section-actions">
                        <button class="btn btn-small" onclick="dashboard.refreshStats()">
                            🔄 Refresh
                        </button>
                        <select id="filter-select" onchange="dashboard.filterLeads(this.value)">
                            <option value="all">All Types</option>
                            <option value="deep">Deep Analysis</option>
                            <option value="light">Light Analysis</option>
                        </select>
                    </div>
                </div>
                
                <!-- Filters -->
                <div class="leads-filters">
                    <button class="filter-btn active" onclick="dashboard.filterLeads('all')" data-filter="all">
                        All Leads
                    </button>
                    <button class="filter-btn" onclick="dashboard.filterLeads('high-score')" data-filter="high-score">
                        High Score (80+)
                    </button>
                    <button class="filter-btn" onclick="dashboard.filterLeads('recent')" data-filter="recent">
                        Last 7 Days
                    </button>
                    <button class="filter-btn" onclick="dashboard.filterLeads('deep')" data-filter="deep">
                        Deep Analysis
                    </button>
                </div>
                
                <!-- Search -->
                <div class="search-container">
                    <input type="text" 
                           id="search-input" 
                           placeholder="Search leads by username or name..." 
                           onkeyup="dashboard.searchLeads(this.value)">
                </div>
                
                <!-- Bulk Actions -->
                <div id="bulk-actions" class="bulk-actions" style="display: none;">
                    <div class="bulk-selection-info">
                        <span id="selected-count">0</span> leads selected
                    </div>
                    <div class="bulk-buttons">
                        <button class="btn btn-secondary" onclick="dashboard.clearSelection()">
                            Clear Selection
                        </button>
                        <button class="btn btn-danger" onclick="dashboard.bulkDeleteLeads()">
                            Delete Selected
                        </button>
                    </div>
                </div>
                
                <!-- Leads Table -->
                <div class="leads-table-container">
                    <table class="leads-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" 
                                           id="select-all-checkbox" 
                                           onchange="dashboard.toggleAllLeads(this)">
                                </th>
                                <th>Lead</th>
                                <th>Platform</th>
                                <th>Score</th>
                                <th>Type</th>
                                <th>Time</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="activity-table">
                            <!-- Leads will be dynamically inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- AI Insights -->
            <section class="insights-section">
                <div class="section-header">
                    <h2>🧠 AI Insights & Recommendations</h2>
                    <button class="btn btn-primary" onclick="dashboard.refreshInsights()">
                        🔄 Refresh Insights
                    </button>
                </div>
                
                <div id="insights-content">
                    <div class="insight-card">
                        <div class="insight-icon">🚀</div>
                        <div>
                            <h4>Welcome to Oslira!</h4>
                            <p>Start researching leads to unlock AI-powered insights and recommendations tailored to your data.</p>
                            <button class="btn btn-small" onclick="dashboard.showAnalysisModal()">
                                Research Your First Lead
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <!-- ============================================================================= -->
    <!-- MODALS -->
    <!-- ============================================================================= -->
    
    <!-- Analysis Modal -->
    <div id="analysisModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>🔎 Analyze Instagram Profile</h3>
                <button class="modal-close" onclick="dashboard.closeModal('analysisModal')">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="analysisForm" onsubmit="dashboard.processAnalysisForm(event)">
                    <div class="form-group">
                        <label for="username">Instagram Username</label>
                        <input type="text" 
                               id="username" 
                               name="username" 
                               placeholder="Enter username (without @)" 
                               required>
                        <small>Enter the Instagram username without the @ symbol</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="analysis-type">Analysis Type</label>
                        <select id="analysis-type" name="analysisType" onchange="dashboard.handleAnalysisTypeChange()" required>
                            <option value="">Select analysis type...</option>
                            <option value="light">Light Analysis (1 credit)</option>
                            <option value="deep">Deep Analysis (2 credits)</option>
                        </select>
                        <div id="analysis-cost-display" class="cost-display"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-id">Business Profile</label>
                        <select id="business-id" name="businessId" required>
                            <option value="">Loading businesses...</option>
                        </select>
                    </div>
                    
                    <button type="submit" id="analysis-submit-btn" class="btn btn-primary" disabled>
                        Select Analysis Type
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Bulk Upload Modal -->
    <div id="bulkModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>📁 Bulk Analysis</h3>
                <button class="modal-close" onclick="dashboard.closeModal('bulkModal')">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="bulkForm">
                    <div class="form-group">
                        <label for="bulk-analysis-type">Analysis Type</label>
                        <select id="bulk-analysis-type" name="analysisType" onchange="dashboard.validateBulkForm()" required>
                            <option value="">Select analysis type...</option>
                            <option value="light">Light Analysis (1 credit each)</option>
                            <option value="deep">Deep Analysis (2 credits each)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="bulk-business-id">Business Profile</label>
                        <select id="bulk-business-id" name="businessId" required>
                            <option value="">Loading businesses...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="bulk-file">Upload File</label>
                        <input type="file" 
                               id="bulk-file" 
                               name="file" 
                               accept=".csv,.txt" 
                               onchange="dashboard.handleFileUpload(event)" 
                               required>
                        <small>Upload a CSV or TXT file with Instagram usernames (one per line)</small>
                    </div>
                    
                    <div id="file-display" class="file-display"></div>
                    
                    <button type="button" id="bulk-submit-btn" class="btn btn-primary" onclick="dashboard.processBulkUpload()" disabled>
                        Select Analysis Type
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Lead Details Modal -->
    <div id="leadDetailsModal" class="modal-overlay">
        <div class="modal large">
            <div class="modal-header">
                <h3>📊 Lead Details</h3>
                <button class="modal-close" onclick="dashboard.closeModal('leadDetailsModal')">&times;</button>
            </div>
            
            <div class="modal-body">
                <div id="lead-details-content">
                    <!-- Lead details will be loaded here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Analysis Queue (will be positioned by JavaScript) -->
    <div id="analysis-queue-container" class="analysis-queue" style="display: none;">
        <!-- Queue items will be dynamically inserted here -->
    </div>
    
    <!-- Success/Error Messages -->
    <div id="notification-container" class="notification-container">
        <!-- Notifications will be dynamically inserted here -->
    </div>
</body>
</html>
