<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="/assets/images/oslira-logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Oslira</title>
    <link rel="stylesheet" href="/core/design-system.css">
    <link rel="stylesheet" href="/pages/dashboard/dashboard.css">
</head>
<body>
    <a href="#main-content" class="skip-nav">Skip to main content</a>
    
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Logo -->
            <div class="logo">
                <img src="/assets/images/oslira-logo.png" alt="Oslira Logo" class="logo-image">
                Oslira
            </div>
            
            <!-- Business Selector -->
            <div class="business-selector">
                <h4>Active Business</h4>
                <select id="business-select" aria-label="Select active business" onchange="businessManager?.handleBusinessChange(this.value)">
                    <option value="">Loading businesses...</option>
                </select>
            </div>
            
            <!-- Navigation Menu -->
            <nav class="menu">
                <div class="menu-section">
                    <h4>Main</h4>
                    <a href="/pages/dashboard/index.html" class="active">
                        <span class="icon">📊</span>
                        Dashboard
                    </a>
                    <a href="/pages/leads/index.html">
                        <span class="icon">🔍</span>
                        Lead Research
                    </a>
                    <a href="/pages/analytics/index.html">
                        <span class="icon">📈</span>
                        Analytics
                    </a>
                </div>
                
                <div class="menu-section">
                    <h4>Tools</h4>
                    <a href="/pages/campaigns/index.html">
                        <span class="icon">🚀</span>
                        Campaigns
                    </a>
                    <a href="/pages/messages/index.html">
                        <span class="icon">💬</span>
                        Messages
                    </a>
                    <a href="/pages/integrations/index.html">
                        <span class="icon">🔗</span>
                        Integrations
                    </a>
                </div>
                
                <div class="menu-section">
                    <h4>Account</h4>
                    <a href="/pages/settings/index.html">
                        <span class="icon">⚙️</span>
                        Settings
                    </a>
                    <a href="/pages/subscription/index.html">
                        <span class="icon">💳</span>
                        Subscription
                    </a>
                </div>
            </nav>
            
            <!-- Subscription Status -->
            <div class="subscription-status">
                <h4>Subscription</h4>
                <div class="plan-name" id="plan-display">Loading...</div>
                <div class="credits-display">
                    <div id="credits-free" class="credits-free">0 free credits</div>
                    <div id="credits-paid" class="credits-paid">0 paid credits</div>
                </div>
                <a href="/pages/subscription/index.html">Manage Subscription</a>
            </div>
            
            <!-- User Info -->
            <div class="user-info">
                <p id="user-email">Loading...</p>
                <a href="#" onclick="window.OsliraApp?.auth?.signOut()">Sign Out</a>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Dashboard Header -->
            <header>
                <div class="header-left">
                    <h1>Dashboard</h1>
                    <p class="header-subtitle">Manage your leads and analyze performance</p>
                </div>
                <div class="header-actions">
                    <button onclick="dashboard?.showAnalysisModal()" class="primary-btn">
                        🔍 Analyze Lead
                    </button>
                    <button onclick="dashboard?.showBulkModal()" class="secondary-btn">
                        📤 Bulk Upload
                    </button>
                    <button onclick="dashboard?.refreshStats()" class="btn btn-small">
                        🔄 Refresh
                    </button>
                </div>
            </header>

            <!-- Stats Grid - Required IDs for StatsCalculator -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-leads">0</div>
                    <div class="stat-label">Total Leads</div>
                    <div class="stat-change positive" id="leads-change" style="display: none;">+0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="average-score">0%</div>
                    <div class="stat-label">Average Score</div>
                    <div class="stat-change" id="score-change" style="display: none;">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="high-value-leads">0</div>
                    <div class="stat-label">High-Value Leads</div>
                    <div class="stat-change" id="high-value-percent" style="display: none;">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="credits-remaining">0</div>
                    <div class="stat-label">Credits Remaining</div>
                    <div class="stat-change" id="credits-used" style="display: none;">0 used</div>
                </div>
            </div>

            <!-- Action Cards -->
            <div class="action-cards">
                <div class="action-card" onclick="dashboard?.showAnalysisModal()">
                    <div class="icon">🔍</div>
                    <h3>Research a Lead</h3>
                    <p>Get AI-powered insights on Instagram profiles with personalized outreach messages</p>
                    <div class="badge">1-2 Credits</div>
                </div>
                
                <div class="action-card" onclick="dashboard?.showBulkModal()">
                    <div class="icon">📤</div>
                    <h3>Bulk Upload</h3>
                    <p>Upload CSV files to analyze multiple leads at once</p>
                    <div class="badge">Coming Soon</div>
                </div>
                
                <div class="action-card" onclick="dashboard?.debugDashboard()">
                    <div class="icon">🛠️</div>
                    <h3>Debug Dashboard</h3>
                    <p>View system status and debug information</p>
                    <div class="badge">Dev Tools</div>
                </div>
            </div>

            <!-- Leads Section -->
            <div class="leads-section">
                <div class="section-header">
                    <h2>Recent Leads</h2>
                    <div class="leads-controls">
                        <div class="search-container">
                            <input type="text" id="lead-search" placeholder="Search leads..." 
                                   onkeyup="dashboard?.searchLeads(this.value)" 
                                   class="form-input">
                        </div>
                    </div>
                </div>

                <!-- Lead Filters -->
                <div class="leads-filters">
                    <button class="filter-btn active" onclick="dashboard?.filterLeads('all')" data-filter="all">
                        All Leads
                    </button>
                    <button class="filter-btn" onclick="dashboard?.filterLeads('high-score')" data-filter="high-score">
                        High Score (80+)
                    </button>
                    <button class="filter-btn" onclick="dashboard?.filterLeads('deep')" data-filter="deep">
                        Deep Analysis
                    </button>
                    <button class="filter-btn" onclick="dashboard?.filterLeads('light')" data-filter="light">
                        Light Analysis
                    </button>
                </div>

                <!-- Bulk Actions Bar -->
                <div class="bulk-actions" id="bulk-actions-bar">
                    <div class="bulk-actions-info">
                        <span id="selected-count">0</span> leads selected
                    </div>
                    <div class="bulk-actions-buttons">
                        <button class="btn" onclick="dashboard?.bulkDeleteLeads()">
                            🗑️ Delete Selected
                        </button>
                        <button class="btn" onclick="dashboard?.clearSelection()">
                            ✕ Clear Selection
                        </button>
                    </div>
                </div>

                <!-- Leads Display Area - Required for LeadRenderer -->
                <div class="leads-container">
                    <div id="leads-grid" class="leads-grid">
                        <!-- Leads will be rendered here by LeadRenderer -->
                    </div>
                    
                    <!-- Empty State -->
                    <div id="leads-empty-state" class="empty-state" style="display: none;">
                        <div class="icon">🔍</div>
                        <h3>No leads yet</h3>
                        <p>Start by analyzing your first Instagram lead to see insights and personalized messages here.</p>
                        <button onclick="dashboard?.showAnalysisModal()" class="primary-btn">
                            Analyze First Lead
                        </button>
                    </div>
                    
                    <!-- Loading State -->
                    <div id="leads-loading" class="loading-overlay">
                        <div class="loading-content">
                            <div class="spinner"></div>
                            <div class="loading-text">Loading leads...</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Analysis Modal - Required by ModalManager -->
    <div class="modal" id="analysisModal">
        <div class="modal-content">
            <button class="modal-close" onclick="dashboard?.closeModal('analysisModal')">×</button>
            <h3>🔍 Research a Lead</h3>
            
            <form id="analysisForm" onsubmit="dashboard?.processAnalysisForm(event)">
                <div class="form-group">
                    <label for="analysis-type">Analysis Type *</label>
                    <select id="analysis-type" required onchange="dashboard?.handleAnalysisTypeChange()">
                        <option value="">Select analysis type...</option>
                        <option value="light">⚡ Light Analysis (1 credit) - Basic profile info</option>
                        <option value="deep">🔍 Deep Analysis (2 credits) - Full insights + outreach message</option>
                    </select>
                </div>
                
                <div class="form-group" id="input-field-container" style="display: none;">
                    <label for="profile-input">Instagram Username *</label>
                    <input type="text" id="profile-input" placeholder="username" autocomplete="off">
                    <p style="font-size: 12px; margin-top: 4px; color: var(--text-secondary);">
                        Enter just the username (without @)
                    </p>
                </div>
                
                <div class="form-group">
                    <label for="business-id">Business Profile</label>
                    <select id="business-id">
                        <option value="">Loading business profiles...</option>
                    </select>
                    <div style="margin-top: 6px; font-size: 12px; color: var(--text-secondary);">
                        💡 Your last used profile is automatically selected. Change if needed.
                    </div>
                </div>
                
                <div style="margin: 20px 0; padding: 16px; background: var(--bg-light); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Credit Cost:</span>
                        <strong id="analysis-cost">Select type</strong>
                    </div>
                </div>
                
                <button type="submit" id="analysis-submit-btn" class="primary-btn" style="width: 100%;">
                    🔍 Start Analysis
                </button>
            </form>
        </div>
    </div>

    <!-- Bulk Upload Modal - Required by ModalManager -->
    <div class="modal" id="bulkModal">
        <div class="modal-content">
            <button class="modal-close" onclick="dashboard?.closeModal('bulkModal')">×</button>
            <h3>📤 Bulk Upload</h3>
            <p style="margin-bottom: 20px; color: var(--text-secondary);">
                Upload a CSV file with Instagram URLs for batch analysis
            </p>
            
            <form id="bulkForm" onsubmit="dashboard?.processBulkUpload(event)">
                <div class="form-group">
                    <label>CSV Format Example:</label>
                    <div style="background: var(--bg-light); padding: 16px; border-radius: 8px; font-family: monospace; font-size: 14px; margin-bottom: 16px;">
                        profile_url,name,notes<br>
                        https://instagram.com/user1,John Doe,CEO at TechCorp<br>
                        https://instagram.com/user2,Jane Smith,Founder at StartupCo
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="bulk-analysis-type">Analysis Type</label>
                    <select id="bulk-analysis-type" required onchange="dashboard?.validateBulkForm()">
                        <option value="">Select analysis type...</option>
                        <option value="light">⚡ Light Analysis (1 credit each)</option>
                        <option value="deep">🔍 Deep Analysis (2 credits each)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="bulk-business-id">Business Profile</label>
                    <select id="bulk-business-id" required>
                        <option value="">Loading business profiles...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <input type="file" id="csv-file" accept=".csv,.txt" 
                           onchange="dashboard?.handleFileUpload(event)" required>
                    <div id="file-display" style="margin-top: 10px;"></div>
                </div>
                
                <button type="submit" id="bulk-submit-btn" class="primary-btn" style="width: 100%;" disabled>
                    Select Analysis Type
                </button>
            </form>
        </div>
    </div>

    <!-- Lead Details Modal - Required by ModalManager -->
    <div class="modal" id="leadDetailsModal">
        <div class="modal-content" style="max-width: 800px;">
            <button class="modal-close" onclick="dashboard?.closeModal('leadDetailsModal')">×</button>
            <h3>📋 Lead Details</h3>
            <div id="lead-details-content">
                <!-- Lead details will be populated by ModalManager -->
            </div>
        </div>
    </div>

    <!-- Security Report Modal -->
    <div class="modal" id="securityModal">
        <div class="modal-content">
            <button class="modal-close" onclick="dashboard?.closeModal('securityModal')">×</button>
            <div style="text-align: center; padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 20px;">🔒</div>
                <h3 style="color: var(--error); margin-bottom: 16px;">Security Issue Detected</h3>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    We detected unusual activity. For security, please contact support.
                </p>
                <button onclick="dashboard?.closeModal('securityModal')" 
                        class="primary-btn" 
                        style="background: var(--error); cursor: pointer; font-weight: 600;">
                    🔒 Security Issue
                </button>
            </div>
        </div>
    </div>

    <!-- Analysis Queue Container - Will be injected by AnalysisQueue -->
    <!-- This gets created dynamically by the AnalysisQueue module -->

    <!-- Script Loading - Maintains your existing pattern -->
    <script src="/core/script-loader.js"></script>
</body>
</html>
